\section{The PhoneLab Testbed}
\label{sec-testbed}

\PhoneLab{} was designed to fill a gap in existing smartphone experimentation
capabilities. Specifically, current experimental approaches are forced to
trade off

\begin{itemize}[nosep]
\vspace*{0.08in}
\item power: permitting the modification of any smartphone software component,
\item scale: facilitating deployment on many devices,
\item and realism: collecting results from a representative set of smartphone users.
\vspace*{0.08in}
\end{itemize}

Distributing experiments via application marketplaces provides realism but
limits research to distributing applications, with scale a possibility but a
challenge due to lack of incentives. Distributing experiments to graduate
students provides power but limits scale and realism.

\PhoneLab{} achieves power by utilizing Android open-source devices and a
self-signed build which allows us to update any software components; scale by
amortizing recruitment overhead, management burden and incentive costs across
multiple experiments; and realism by recruiting a diverse set of participants
and limiting experimental intrusiveness. We describe the architecture of the
\PhoneLab{} testbed in more detail below.

\subsection{Overview}

\PhoneLab{} currently consists of 190 participants\footnote{We refer to
people carrying \PhoneLab{} phones and participating in experiments as
\PhoneLab{} \textit{participants}, to differentiate them from researchers
running \PhoneLab{} experiments which we call \textit{users}.} using Sprint
Nexus~S~4G smartphones~\cite{nexuss4g} running Android 4.1.1 ``Jelly
Bean''~\cite{jellybean}. Participants receive discounted voice, data,
and messaging and are instructed to use their \PhoneLab{} phone as their
primary device.

\PhoneLab{} experiments are either distributed through the Play Store or as
platform over-the-air (OTA) updates. Participants are notified of new
experiments and choose whether to participate after reviewing what
information will be collected about them. \PhoneLab{} participants are
\textit{required} to participate in experimentation but \textit{not required}
to participate in any particular experiment. They may uninstall experiments
that they deem too intrusive or that negatively affect their device. Some
experiments may run in the foreground like typical applications and require
the participant interact with them. Others may run quietly in the background
collecting useful information or taking measurements.

\PhoneLab{} users must provide human subjects review documentation, a list of
log tags to capture, and their experimental software---either a link to the
Play Store or a patch against the current \PhoneLab{} platform source.
Experiments generate data through the standard Android logging interface. Log
messages generated by \PhoneLab{} experiments are captured and uploaded to a
central server while the device is plugged in and charging. When
experimentation completes, the user receives an archive containing every log
message matching their tags generated by all \PhoneLab{} devices that
participated in their experiment.

\subsection{Platform and Device}

\PhoneLab{} phones run the popular Google Android open-source smartphone
platform (AOSP). Using an open-source platform for \PhoneLab{} was an obvious
choice for obvious and less-obvious reasons.

The obvious reason is that the AOSP allows \PhoneLab{} users to experiment
with any software component, meeting our goal of providing a powerful
testbed. Modifications to Android services that provide location, access
networks, and manage power can be benchmarked alongside unmodified devices.
Of course, power also creates problems: faulty experiments can render phones
inoperable and threaten participation. As a result, experimentation at the
platform level will require additional pre-deployment testing and interaction
with the \PhoneLab{} team when compared with experiments that only distribute
novel applications or collect data at the application level.

We have also found that using an open-source platform has other, less obvious
benefits. First, the availability of the Android source makes \PhoneLab{}
instrumentation easier even when collecting data from the application level.
Our usage characterization experiment, described in
Section~\ref{sec-experiment}, uses Java introspection facilitated by access
to the Android source to access hidden battery usage information.

Second, the AOSP allows us to sign the platform image used by our
participants. When the same key is used to sign a software package, that
application may run as the system user with root privileges. Using this
feature allows us to distribute and update core \PhoneLab{} experimental
management software via the Google Play Store while retaining the privileges
necessary to collect logs and perform platform updates.

Finally, we expect that our base \PhoneLab{} platform image will evolve to
meet the needs of the research community. While we have found that Android
already logs a wealth of information about platform operation, there are
places where more information could be exposed or logged in a more
experiment-friendly way. Controlling the platform provides the opportunity to
supplement existing interfaces or add additional logging to make
experimentation and data collection easier.

\begin{table}[t]
\begin{threeparttable}
\begin{tabularx}{\columnwidth}{lX}
\toprule
\textbf{CPU} & 1~GHz ARM Cortex A8 \\
\textbf{GPU} & PowerVR SGX540 \\
\textbf{RAM} & 512 MB\tnote{1} \\
\textbf{Storage} & 16~GB of NAND Flash, divided into 1 and 15~GB partitions.\\
\textbf{Battery} & \num{1500}~mAh 3.7~V Li-ion.\\
\textbf{Display} & 4" 480~x~800 touch screen.\\
\textbf{Networking} & 1x/3G/4G (WiMax) cellular data, 802.11 b/g/n WiFi,
Bluetooth, NFC, and USB.\\
\textbf{Sensors} & GPS, accelerometer, gyroscope, proximity and compass.\\
\bottomrule
\end{tabularx}

{\footnotesize
\begin{tablenotes}
\item [1] 128~MB is reserved for the GPU.
\end{tablenotes}}

\caption{\textbf{The Samsung Nexus S 4G smartphone.}}
\label{table-nexuss4g}
\end{threeparttable}
\end{table}

We have distributed Nexus S 4G smartphones to our first group of
participants. The Nexus S 4G was first released by Sprint in May, 2011, and
was one of the official AOSP development phones at the time \PhoneLab{}
development began. It features are summarized in Table~\ref{table-nexuss4g}.
While we expect to receive yearly phone upgrades and will distribute more
up-to-date device to our second group of participants, we anticipate that the
prohibitive cost of the newest smartphones will prevent us from ever
deploying them on \PhoneLab{}.

\subsection{Participants}

Recruiting a large number of \PhoneLab{} participants requires effective
incentives. In their first year of \PhoneLab{} participation, voice data and
messaging are free with funding provided by the National Science Foundation
(NSF). This free year of service plays a major role in our recruiting
efforts. In subsequent years, participants pay a deeply discounted \$45 per
month rate for unlimited data and messaging through a deal negotiated with
Sprint. Sprint has proved to be an ideal partner for the \PhoneLab{} project,
both helpful with testbed logistics and still willing to provide unlimited
data plans to subscribers.

Because participants may leave at any time, the front-loaded cost structure
of our incentives makes it most efficient to recruit participants who will be
able to continue as part of \PhoneLab{} for multiple years. While we
anticipate that some of our first group of participants will leave after a
single year, they will help us more effectively recruit long-term
participants during future years. On the other hard, long-term participants
allow us to continue to amortize the costs of the first free year and of
recruitment itself while providing us with a stable set of participants
comfortable being a part of \PhoneLab{} experimentation.

When recruiting our first batch of participants, we initially intended to
target freshman and sophomore SUNY Buffalo (UB) students studying computer
science and engineering. We found, however, that many of these students
already owned smartphones. At this point we broadened our first- and
second-year student recruitment across all disciplines as well as incoming
PhD students. The University at Buffalo has a large international graduate
student community, and many of these students arrive on campus without phones
or phone contracts, making them ideal multi-year \PhoneLab{} participants.

After a first round of smartphone distribution in late August and early
September 2012, we also began to rethink targeting students and instead
started to reach out to the professional population at SUNY Buffalo. We
realized that many students are still covered by their parents family plans,
which made us worry that they might abandon the testbed after the first free
year. Faculty and staff, in contrast, are both used to paying for monthly
mobile phone service and frequently maintain long affiliations with the
university.

\begin{table}[t]
\begin{threeparttable}
\begin{tabularx}{\columnwidth}{Xr@{\hspace{0.5in}}Xr}
\multicolumn{4}{c}{\textbf{Affiliation}} \\
\midrule
Freshman & 64 & Masters & 5 \\
Sophomore & 33 & PhD & 53 \\
Junior & 1 & Faculty/Staff & 29 \\
Senior & 1 & None & 5 \\[0.1in]
\multicolumn{4}{c}{\textbf{Gender}} \\
\midrule
Female & 51 & Male & 140 \\[0.1in]
\multicolumn{4}{c}{\textbf{Age}} \\
\midrule
Under 18 & 12 & 30--34 & 15 \\
18--19 & 74 & 35--39 & 6 \\
20--21 & 12 & 40--49 & 13 \\
22--24 & 22 & 50--59 & 7 \\
25--29 & 29 & 60+ & 1 \\
\end{tabularx}
\end{threeparttable}
\caption{\textbf{Demographic breakdown of 191 \PhoneLab{} participants.} Date
ranges are inclusive.}
\label{table-demographics}
\end{table}

In the end, our first round of \PhoneLab{} participant recruitment was done
largely without careful planning as to the testbed demographic breakdown. We
were focused primarily on ensuring that all phones were distributed promptly
to willing participants. Table~\ref{table-demographics} describes the
demographic breakdown that we achieved. Roughly half of our participants are
first- and second-year undergraduates, a quarter PhD students, and a fifth
faculty, staff and other professionals. Males greatly outnumber females, and
the young outnumber the middle-aged and older, both unrepresentative features
we will try and rectify in year two. For management reasons we limited
participation to people with a SUNY Buffalo affiliation, except in a few
select cases which include a local reporter, a technology writer, and an
international rock star.

\subsection{Testbed Software}

\PhoneLab{} devices are deployed with a small piece of testbed management
software embedded in the Android platform image. This heartbeat service
uploads periodic reports including information about device location, battery
levels, and the installation status of other core \PhoneLab{} software
components. This information is only used for testbed
management--particularly for locating lost phones---and will never be
released to researchers.

The heartbeat service is also responsible for starting the primary
\PhoneLab{} configuration and data collection harness when the phone boots,
which allows us to bypass an Android security feature that normally prevents
services from running in the background unless started by an foreground
application. In order to remain unobtrusive, our experimental harness does
not have a foreground component and thus would not normally be able to be
started.

Experimental configuration, log collection, data upload and platform updates
are performed by the \PhoneLab{} experimental harness, which is installed and
updated through the Google Play Store. By signing it to match the platform
build key it runs with root privileges, necessary to collect logs from all
applications and perform platform updates. Periodically, the experimental
harness retrieves an XML configuration from a central \PhoneLab{} server. The
configuration specifies what background experiments to start or stop, what
data to collect, which server the phone should upload data to and the policy
for when to perform uploads. The \PhoneLab{} harness also upload status
information to the server during the configuration exchange, including what
versions of various harness components are installed, what experiments are
running and how much data is waiting to be uploaded.

% 10 Dec 2012 : GWA : FIXME : Numbers.

\PhoneLab{} logging and data collection must be unintrusive. If it is not,
either our participants will leave or their usage patterns will be affected.
We believe that we have achieved this goal. First, measured battery usage of
\PhoneLab{} is low. A conservative overhead estimate that includes all of the
applications that run as the shared system user comes to a per-participant
average of 2.4\%. This should be considered a strict maximum. Our policy of
only uploading while the device is plugged and charging eliminates the
overhead of the most power-hungry task.

Second, we have received no major complaints about our the final version of
our \PhoneLab{} experimental harness after we instructed participants to
install it. Given that participants we allowed to use their phone without our
software for several months, we believe that any significant changes in phone
behavior caused by our experimental harness would have been noticed.

\subsection{Safety and Privacy}

\PhoneLab{} is different from many other computer systems testbeds, such as
Emulab~\cite{white:osdi:2002, emulab}, PlanetLab~\cite{peterson:ccr:2003,
planetlab}, MoteLab~\cite{werner-allen:ipsn:2005}, or
OpenCirrus~\cite{avetisyan:computer:2010, opencirrus}: our experiments involve
real people. There are two core requirements regarding our participants. First,
they should use their phone as they normally would, which motivated the design
of the unintrusive testbed management software described previously. Second, and
more importantly, they must feel safe and in control while a part of
\PhoneLab{}.

To accomplish this, when possible, we leverage several existing safety
mechanisms. First, we require an Institutional Review Board to (IRB) review
each \PhoneLab{} experiment for human subjects compliance. IRB approval or an
official waiver is required before any \PhoneLab{} any experiment can begin.

Second, we distribute experimental applications to a group of developers
prior to broader release, allowing us to identify any significant problems
before they reach our participants. This step is particularly important for
platform experiments, which must be established as stable before being
distributed.

Finally, we utilize Android's existing safety and privacy mechanisms.
Participants are presented with the typical Android privacy dialog during
experiment installation. Rather than building an alternate distribution
channel or privacy mechanism, we felt it was sufficient and probably better
to use a process participants are familiar with. After installation, if a
participant discovers that an experiment they have installed is buggy or
wasting power, they can uninstall it. If we notice patterns of experimental
removal, we will flag the experiment and notify the researcher.

\subsection{Bootstrapping and Management}

We began advertising \PhoneLab{} on campus via posters, flyers, Facebook, and
mass emails in late July, 2012. As mentioned previously, \PhoneLab{} phone
distribution began on August 24, 2012. Most phones were distributed between
August 24, 2012 and August 31, 2012. Our initial plan was to distribute 200
phones during that period, but we ran into an unexpected shortage of
supplies for Nexus S 4G. Due to this reason, the last device was handed out on
October 29, 2012.

We delayed the release of our experimental harness for two months until
November 8, 2012. This was done for several reasons. First, we wanted to
complete the distribution of phones. Second, we wanted to complete development
and testing of the harness and backend infrastructure. Third, we wanted to
receive training in human subjects experimentation and prepare the materials for
our first experiment. Finally, the delay allowed our participants to develop
normal usage patterns before experimentation began. For this last reason, we may
repeat a shorter version of this delay with subsequent new groups of \PhoneLab{}
participants.

\subsection{Experimental Procedures}

To conclude, we review the process of developing and submitting an experiment
on \PhoneLab{} from a researcher perspective.

First, develop your application locally. Any information logged through the
standard Java logging library can be recorded. In addition, the platform may
already be logging useful information for you. Keep track of all the log tags
you want \PhoneLab{} to capture. Approach your local IRB and receive
experimental approval, upload your application to the Play Store and continue
to test locally.

Second, upload your list of log tags, IRB letter, and link to your
application on the Play Store through the \PhoneLab{}
website\footnote{\url{http://www.phone-lab.org}}. We will contact you when we
begin beta testing and again once your experiment is ready for the testbed.
During beta testing you'll be provided with \PhoneLab{} log output to ensure
that your experiment is running properly.

Finally, your experiment will be scheduled on the testbed. Our goal is to
maintain a medium-sized list of active experiments for our participants:
large enough to make good use of the testbed, but small enough to ensure that
each experiment is picked up by many participants. When your experiment
completes, you'll receive a archive with messages matching the tags you
selected.
